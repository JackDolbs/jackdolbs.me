---
description: Useful cheatsheet for Postgres
---
# PostgreSQL cheatsheet

Useful cheatsheet for Postgres

## Upgrading

Updating a running server (from 10 to 11):

```bash
apt-get install -y postgres-11 # Install the latest version, which will start on port 5433
sudo pg_dropcluster 11 main --stop # Stop the instance on port 5433
sudo pg_upgradecluster 10 main  # Upgrade the instance on port 5432
sudo pg_dropcluster 10 main  # Drop the outdated instance
```

## Templates

### New tables

```sql
CREATE TABLE public.table_name (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  data jsonb,
  inserted_at timestamp without time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at timestamp without time zone DEFAULT timezone('uc'::text, now()) NOT NULL
);

COMMENT ON TABLE public.table_name IS 'Some table name.';
COMMENT ON COLUMN public.table_name.inserted_at IS 'UTC timestamp of when the record was inserted.';
COMMENT ON COLUMN public.table_name.updated_at IS 'UTC timestamp of when the record was last updated.';
```


## Utilities

- [Updating tables with dependent views](https://stackoverflow.com/questions/17989355/alter-column-ignoring-dependent-views). Usage exanple:
    ```sql
    select deps_save_and_drop_dependencies('public', 'users');
    select deps_restore_dependencies('public', 'users');
    ```

## Resources

- [Designing the most performant Row Level Security schema](https://news.ycombinator.com/item?id=22331188)
- [Postgresqlco.nf: PostgreSQL Configuration for Humans](https://news.ycombinator.com/item?id=22139975)
- [Pgsh – branch Postgres like Git](https://hn.premii.com/#/comments/21642340)
- [Postgres Health Check and SQL Performance Analysis](https://news.ycombinator.com/item?id=21464272)
- [pg_flame – flamegraph visualizations of PostgreSQL query plans](https://news.ycombinator.com/item?id=21371642)